#!/bin/bash
################################## !!! README !!! #######################################
#                                                                                       #
# Script name: vdr_installer_2.6.4                                                  #
# Version: Git Repository Master (https://github.com/fiveten59/Vdr_installer)           #
# Tested on Ubuntu 22.04 - Ubuntu 20.04 - Mint 20.2 - Mint 21 - Debian Bullseye         #
# chmod the script                                                                      #
# then load it simply typing: sudo ./vdr_installer_2.6.4  (Ubuntu/Mint)                 #
#                             su - /vdr_installer_2.6.4  (Debian)                       #
#########################################################################################
#
clear
REPO="/home/`logname`/Vdr_repo"
PLUGIN="--lirc -P'dvbapi' -P'skinlcarsng' -P'iptv' -P'radio -l /etc/vdr/plugins/radio/rtextUnten-kleo2.mpg'"
PLUGINSERVER="-P'dvbapi' -P'iptv' -P'vnsiserver'"
ETC='/usr/local/etc'
SRC='/usr/local/src'
SRCVDR='$SRC/vdr-2.6.4'
VDRSRC=''$SRC'/vdr/PLUGINS/src'
LIB='/usr/lib/vdr'
VDR='vdr-2.6.4'
PACKAGES="$SRC/packages"
TEMP='/tmp'
SHARE='/usr/share/vdr/plugins'
PLUGINS='/etc/vdr/plugins'
Remind3='is already installed'
Remind4='are already installed'
Remind5='is not installed'
ALLOWED="#
# allowed_hosts.conf

# Syntax:
# IP-Address[/Netmask]
#
127.0.0.1             # always accept localhost
192.168.1.0/24        # any host on the local net
192.168.0.0/24        # any host on the local net
#204.152.189.113      # a specific host
#0.0.0.0/0            # any host on any net (USE THIS WITH CARE!)
#
"
#               Disecq

TRIAL="
# Full DiSEqC sequence:
# 9 - 13 - 19.2E
S9E  11700 V  9750 t v W15 [E0 10 38 F0] W15 A W15 T
S9E  99999 V 10600 t v W15 [E0 10 38 F1] W15 A W15 T
S9E  11700 H  9750 t V W15 [E0 10 38 F2] W15 A W15 T
S9E  99999 H 10600 t V W15 [E0 10 38 F3] W15 A W15 T

S13.0E 11700 V  9750 t v W15 [E0 10 38 F4] W15 B W15 t
S13.0E 99999 V 10600 t v W15 [E0 10 38 F5] W15 B W15 T
S13.0E 11700 H  9750 t V W15 [E0 10 38 F6] W15 B W15 t
S13.0E 99999 H 10600 t V W15 [E0 10 38 F7] W15 B W15 T

S19.2E 11700 V  9750 t v W15 [E0 10 38 F8] W15 A W15 t
S19.2E 99999 V 10600 t v W15 [E0 10 38 F9] W15 A W15 T
S19.2E 11700 H  9750 t V W15 [E0 10 38 FA] W15 A W15 t
S19.2E 99999 H 10600 t V W15 [E0 10 38 FB] W15 A W15 T
#
"
DUAL="#
# Full DiSEqC sequence:
# 13 - 19.2E
S13.0E 11700 V  9750  t v W15 [E0 10 38 F0] W15 A W15 t
S13.0E 99999 V 10600  t v W15 [E0 10 38 F1] W15 A W15 T
S13.0E 11700 H  9750  t V W15 [E0 10 38 F2] W15 A W15 t
S13.0E 99999 H 10600  t V W15 [E0 10 38 F3] W15 A W15 T

S19.2E  11700 V  9750  t v W15 [E0 10 38 F4] W15 B W15 t
S19.2E  99999 V 10600  t v W15 [E0 10 38 F5] W15 B W15 T
S19.2E  11700 H  9750  t V W15 [E0 10 38 F6] W15 B W15 t
S19.2E  99999 H 10600  t V W15 [E0 10 38 F7] W15 B W15 T
#
"
MONO5E="#
# Full DiSEqC sequence:
# Astra 4 - 4.8°E
S4.8E 11700 V  9750  t v W15 [E0 10 38 F0] W15 A W15 t
S4.8E 99999 V 10600  t v W15 [E0 10 38 F1] W15 A W15 T
S4.8E 11700 H  9750  t V W15 [E0 10 38 F2] W15 A W15 t
S4.8E 99999 H 10600  t V W15 [E0 10 38 F3] W15 A W15 T
#
"
MONO9="#
# Full DiSEqC sequence:
# Eutelsat 9 - 9.0°E
S9.0E 11700 V  9750  t v W15 [E0 10 38 F0] W15 A W15 t
S9.0E 99999 V 10600  t v W15 [E0 10 38 F1] W15 A W15 T
S9.0E 11700 H  9750  t V W15 [E0 10 38 F2] W15 A W15 t
S9.0E 99999 H 10600  t V W15 [E0 10 38 F3] W15 A W15 T
#
"
MONO13="#
# Full DiSEqC sequence:
# Hotbird - 13.0°E
S13.0E 11700 V  9750  t v W15 [E0 10 38 F0] W15 A W15 t
S13.0E 99999 V 10600  t v W15 [E0 10 38 F1] W15 A W15 T
S13.0E 11700 H  9750  t V W15 [E0 10 38 F2] W15 A W15 t
S13.0E 99999 H 10600  t V W15 [E0 10 38 F3] W15 A W15 T
#
"
MONO13_CAMPER="#
# Full DiSEqC sequence:
# Hotbird - 13.0°E
S13.0E 11700 V  9750  t v W15 [E0 10 38 F0] W15 A W15 t
S13.0E 99999 V 10600  t v W15 [E0 10 38 F1] W15 A W15 T
S13.0E 11700 H  9750  t V W15 [E0 10 38 F2] W15 A W15 t
S13.0E 99999 H 10600  t V W15 [E0 10 38 F3] W15 A W15 T
#
"
MONO19="#
# Full DiSEqC sequence:
# Astra 19 - 19.2°E
S19.2E 11700 V  9750  t v W15 [E0 10 38 F0] W15 A W15 t
S19.2E 99999 V 10600  t v W15 [E0 10 38 F1] W15 A W15 T
S19.2E 11700 H  9750  t V W15 [E0 10 38 F2] W15 A W15 t
S19.2E 99999 H 10600  t V W15 [E0 10 38 F3] W15 A W15 T
#
"
MONO23="#
# Full DiSEqC sequence:
# Astra 23 - 23°E
S23.0E 11700 V  9750  t v W15 [E0 10 38 F0] W15 A W15 t
S23.0E 99999 V 10600  t v W15 [E0 10 38 F1] W15 A W15 T
S23.0E 11700 H  9750  t V W15 [E0 10 38 F2] W15 A W15 t
S23.0E 99999 H 10600  t V W15 [E0 10 38 F3] W15 A W15 T
#
"
MONO28="#
# Full DiSEqC sequence:
# Astra 28 - 28.2°E
S28.2E 11700 V  9750  t v W15 [E0 10 38 F0] W15 A W15 t
S28.2E 99999 V 10600  t v W15 [E0 10 38 F1] W15 A W15 T
S28.2E 11700 H  9750  t V W15 [E0 10 38 F2] W15 A W15 t
S28.2E 99999 H 10600  t V W15 [E0 10 38 F3] W15 A W15 T
#
"
MONO42="#
# Full DiSEqC sequence:
# Turksat - 42°E
S42.0E 11700 V  9750  t v W15 [E0 10 38 F0] W15 A W15 t
S42.0E 99999 V 10600  t v W15 [E0 10 38 F1] W15 A W15 T
S42.0E 11700 H  9750  t V W15 [E0 10 38 F2] W15 A W15 t
S42.0E 99999 H 10600  t V W15 [E0 10 38 F3] W15 A W15 T
#
"
MONO08W="#
# Full DiSEqC sequence:
# Thor - 0.8°W
S0.8W 11700 V  9750  t v W15 [E0 10 38 F0] W15 A W15 t
S0.8W  99999 V 10600  t v W15 [E0 10 38 F1] W15 A W15 T
S0.8W  11700 H  9750  t V W15 [E0 10 38 F2] W15 A W15 t
S0.8W  99999 H 10600  t V W15 [E0 10 38 F3] W15 A W15 T
#
"
MONO5W="#
# Full DiSEqC sequence:
# Eutelsat 5 - 5°W
S5.0W 11700 V  9750  t v W15 [E0 10 38 F0] W15 A W15 t
S5.0W 99999 V 10600  t v W15 [E0 10 38 F1] W15 A W15 T
S5.0W 11700 H  9750  t V W15 [E0 10 38 F2] W15 A W15 t
S5.0W 99999 H 10600  t V W15 [E0 10 38 F3] W15 A W15 T
#
"
MONO30W="#
# Full DiSEqC sequence:
# Hispasat - 30°W
S30.0W 11700 V  9750  t v W15 [E0 10 38 F0] W15 A W15 t
S30.0W 99999 V 10600  t v W15 [E0 10 38 F1] W15 A W15 T
S30.0W 11700 H  9750  t V W15 [E0 10 38 F2] W15 A W15 t
S30.0W 99999 H 10600  t V W15 [E0 10 38 F3] W15 A W15 T
#
"
#
apt -y install dialog git subversion wget pkg-config
apt -y install checkinstall build-essential autoconf 
apt -y install autopoint automake cmake libtool
#
sudo useradd vdr -g video -d /home/vdr -s /bin/bash -m
mkdir $SRC/packages
dialog --title " VDR 2.6.4 Installer " --infobox "

    A special thanks goes to Klaus Schmidinger Vdr Developer

    Script name: vdr_installer_2.6.4
    Version: 2.6.4
    Tested on Ubuntu 20.04 - Ubuntu 22.04 - Mint 20.2 - Mint 21 - Debian 11
    chmod the script 'vdr_installer_2.6.4'
    then load it simply typing: sudo ./vdr_installer_2.6.4 " 0 0


echo "                    Press Enter to continue ...               "
sleep 2
read enterKey

#############################################################

clear
while :
do
clear
echo ""
dialog --title "   ♦♦♦♦♦   VDR 2.6.4 Version Installer Script - Libraries & Codec  ♦♦♦♦♦   " --infobox "


	   ==============================================================================	
	   ................   Download & Upgrade Local Repository   ...................
	   ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
	   [1]    +[Submenu]   Local Repository Directory ~ Install - Upgrade   .......
	   ==============================================================================
	   ..........   Sat Firmware & Audio Video & Infrared Control  ................
	   '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''' 
	   [2]    +[Submenu]  Install & Uninstall  ....................................
	   ==============================================================================
	   ............................   VDR   .......................................
	   ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
	   [3]    +[Submenu]   Install & Uninstall  ...................................
	   ==============================================================================
	   ..........................   Vdr Plugins   ..................................
           ............................................................................
	   [4]    +[Submenu] ~~  Install & Uninstall  .................................
	   ==============================================================================
	   .......................   Final configuration   ............................
	   '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''' 
	   [5]    +[Submenu] ~~  Vdr (Stand alone) - Vdr Server (Need Kodi) ...........	   
	   ==============================================================================
	   ............................   Kodi   ......................................
	   ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
	   [6]    +[Submenu]   Install & Uninstall  ...................................	   
	   ==============================================================================
	   .............................   Exit Setup Menu   ..........................
	   [7]     Exit  ..............................................................
	   ============================================================================== " 0 0

echo -n "              Enter your menu choice = Submenu [1~6] -- Exit [7] :        "
read yourch
case $yourch in
#
1)
cd /home/`logname`
clear
dialog --title "   ** Download & Upgrade Local Repository **   " --infobox "
   ---------------------------------------------------------------------------------------------
       Install ~ Upgrade ~ Remove ~ Local Repository
   ---------------------------------------------------------------------------------------------
        [a]  Download libs - progs & patch for Vdr
        [b]  Remove & Upgrade all

        [z]  Skip
   ---------------------------------------------------------------------------------------------" 0 0
echo -n "     Enter your menu choice = Install [a] ~~ Remove & Upgrade [b] ~~ Skip [z]      "
read yourch
case $yourch in
#
a) clear
echo "Downloading libs - progs & patch for Vdr - Intel & Nvidia Video devices on local repo "
sleep 2

if [ -d /home/`logname`/Vdr_repo ]; then
  echo " ..... Folder exists ..... "
else
  echo "Folder not found ... Create & Downloading it now ....."
    git clone https://github.com/fiveten59/Vdr_repo.git
  fi
  
cd Vdr_repo 

#if [ -e $REPO/ffmpeg-5.1.tar.bz2 ]; then
if [ -e $REPO/ffmpeg-4.4.1.tar.bz2 ]; then
  echo " ..... File exists ..... "
else
  echo "File not found ... Downloading it now ....."
#    wget https://ffmpeg.org/releases/ffmpeg-5.1.tar.bz2
    wget https://ffmpeg.org/releases/ffmpeg-4.4.1.tar.bz2    
fi

if [ -e $REPO/eventlircd ]; then
  echo " ..... File exists ..... "
else
  echo "File not found ... Downloading it now ....."
    git clone https://github.com/LibreELEC/eventlircd.git
fi

echo "Downloading Vdr and Plugins on local repo "
sleep 2

if [ -e $REPO/vdr-2.6.4 ]; then
  echo " ..... File exists ..... "
else
  echo "File not found ... Downloading it now ....."
    git clone --branch stable/2.6 git://git.tvdr.de/vdr.git vdr-2.6.4
  fi
  
if [ -e $REPO/vdr-plugin-softhddevice ]; then
  echo " ..... File exists ..... "
else
  echo "File not found ... Downloading it now ....."
    git clone https://github.com/ua0lnj/vdr-plugin-softhddevice.git
  fi  

if [ -e $REPO/vdr-plugin-dvbapi ]; then
  echo " ..... File exists ..... "
else
  echo "File not found ... Downloading it now ....."
    git clone https://github.com/ua0lnj/vdr-plugin-dvbapi.git 
  fi

if [ -e $REPO/vdr-plugin-iptv ]; then
  echo " ..... File exists ..... "
else
  echo "File not found ... Downloading it now ....."
    git clone https://github.com/rofafor/vdr-plugin-iptv.git
  fi

if [ -e $REPO/vdr-plugin-radio ]; then
  echo " ..... File exists ..... "
else
  echo "File not found ... Downloading it now ....."
    git clone https://github.com/siricco/vdr-plugin-radio.git
fi

if [ -e $REPO/vdr-plugin-vnsiserver ]; then
  echo " ..... File exists ..... "
else
  echo "File not found ... Downloading it now ....."
    git clone https://github.com/vdr-projects/vdr-plugin-vnsiserver.git
fi
#
echo "Downloading skins "
sleep 2

if [ -e $REPO/skinlcarsng ]; then
  echo " ..... File exists ..... "
else
  echo "File not found ... Downloading it now ....."
    git clone https://gitlab.com/kamel5/skinlcarsng.git
  fi

echo "Downloading others "
sleep 2
  
if [ -e $REPO/logos ]; then
  echo " ..... File exists ..... "
else
  echo "File not found ... Downloading it now ....."
    git clone https://github.com/fiveten59/Logos.git logos
  fi
#
cd ..
chmod -R 777 Vdr_repo;;

#############################################################

b)
clear
cd /home/`logname`/
rm -rf Vdr_repo
git clone https://github.com/fiveten59/Vdr_repo.git
cd Vdr_repo

echo "                    Remove & Downloading Intel & Nvidia Video devices on local repo "

git clone https://github.com/intel/intel-vaapi-driver.git

echo "                    Downloading libs - progs & patch for Vdr on local repo "

#wget https://ffmpeg.org/releases/ffmpeg-5.1.tar.bz2
wget https://ffmpeg.org/releases/ffmpeg-4.4.1.tar.bz2
git clone https://github.com/OpenELEC/eventlircd.git
git clone --branch stable/2.6 git://git.tvdr.de/vdr.git vdr-2.6.4
git clone https://github.com/ua0lnj/vdr-plugin-softhddevice.git
git clone https://github.com/ua0lnj/vdr-plugin-dvbapi.git 
git clone https://github.com/siricco/vdr-plugin-radio.git
git clone https://github.com/rofafor/vdr-plugin-iptv.git
git clone https://github.com/vdr-projects/vdr-plugin-vnsiserver.git

echo "                    Downloading skins "

git clone https://gitlab.com/kamel5/skinlcarsng.git

echo "                    Downloading others "

git clone https://github.com/fiveten59/Logos.git logos
#
cd ..
chmod -R 777 Vdr_repo;;
z) ;;
esac ;;

#############################################################

2)
clear
cd $SRC
mkdir -p ffmpeg_sources
#
clear
dialog --title "   ** Install Intel / Nvidia & Common Libraries **   " --infobox "
--------------------------------------------------------------------------------------------------
                                     Install or Remove Libraries
--------------------------------------------------------------------------------------------------

                                *****     Install Common Libs      *****
        [a]    FFmpeg        
        [b]    Infra-Red Remotes Control
        [c]    Installing Sat firmware

                                *****     Install Intel drivers      *****                                        
        [d]    ONLY FOR Intel Devices (Intel vaapi driver - OPTIONAL)        

       
                                *****     Remove Common Libs      *****
        [a1]    FFMPEG
        [b1]    Lirc
        [c1]    Eventlircd

                                *****     Remove Intel Libs      *****
        [d1]    Remove Libva - Cmrt - Intel vaapi driver
      
        [z]     Skip

--------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------
" 0 0

echo -n "        Enter your menu choice = Install [a-d] ~~ Remove [a1-d1] ~~ Exit [z]:      "
read yourch
case $yourch in
#
a)
clear
echo "                    Installing Nv-Codec"
sleep 2
cd $SRC/ffmpeg_sources/
rm -rf nv-codec-headers
git clone https://github.com/FFmpeg/nv-codec-headers
cd nv-codec-headers
make && make install
#
echo "                    Installing Ffmpeg"
sleep 2
if [ -d $SRC/ffmpeg_sources/ffmpeg ]
then echo "Ffmpeg is already installed"; sleep 3
else
apt -y install libavfilter-dev libx265-dev libavcodec-dev yasm libass-dev 
apt -y install libavformat-dev libswresample-dev libswscale-dev libudev-dev
apt -y install libfreetype6-dev libmp3lame-dev libtheora-dev libvorbis-dev
apt -y install libxvidcore-dev freeglut3-dev libssl-dev libvdpau-dev libdrm-dev
apt -y install libxcb-dpms0-dev libxcb-glx0-dev libxcb-randr0-dev libxcb-screensaver0-dev 
apt -y install libxcb-xv0-dev libxcb-image0-dev libxcb-util0-dev libxcb-icccm4-dev libxcb-keysyms1-dev
apt -y install libglew-dev libglm-dev mesa-common-dev libogg-dev libva-dev
apt -y install libpciaccess-dev xorg-dev libpulse-dev libx265-dev

    echo "                    Wait for a few seconds ..."
cd $SRC/ffmpeg_sources
#cp -rf $REPO/ffmpeg-5.1.tar.bz2 $SRC/ffmpeg_sources/
#tar xjvf ffmpeg-5.1.tar.bz2
#mv ffmpeg-5.1 ffmpeg
#rm -rf ffmpeg-5.1.tar.bz2
cp -rf $REPO/ffmpeg-4.4.1.tar.bz2 $SRC/ffmpeg_sources/
tar xjvf ffmpeg-4.4.1.tar.bz2
mv ffmpeg-4.4.1 ffmpeg
rm -rf ffmpeg-4.4.1.tar.bz2
cd ffmpeg
./configure --extra-libs="-ldl" --enable-gpl --enable-libfreetype --enable-libmp3lame --enable-openssl --enable-libxcb --disable-libopus --enable-libtheora --enable-libvorbis --enable-libx265 --enable-cuvid --enable-nonfree --enable-libxvid --enable-opengl --enable-vdpau --enable-vaapi --enable-pic --enable-shared  --disable-doc --enable-swresample --disable-cuda-sdk --enable-libpulse
# --enable-nvenc

    echo "                    Press Enter to continue ...               "
    read enterKey
make -j10
make install
#checkinstall --pkgname=ffmpeg --pkgversion="5.1" --backup=no --deldoc=yes --fstrans=no --default --pakdir=$PACKAGES
apt-mark hold ffmpeg
sleep 3
echo "                    FFmpeg installed "; sleep 2
fi;;

#############################################################

b)
clear
echo "                    Installing Infra-Red Remotes Control"
sleep 2
clear
#
    dialog --title "   ** Infra-Red Remotes Control **   " --infobox "
   ----------------------------------------------
              Infra-Red Remotes Control
   ----------------------------------------------
        [a]    Lirc
        [b]    Eventlircd

        [z]    Skip

    ---------------------------------------------- " 0 0
    echo -n "        Enter your menu choice  [a-z]:      "
    read yourch
    case $yourch in

a) 
clear
if [ -d /etc/lirc/hardware.conf ]
then echo "Lirc is already installed"; sleep 3
else apt remove ir-keytable lirc
apt purge ir-keytable lirc
echo 'deb [trusted=yes] http://ca.archive.ubuntu.com/ubuntu/ xenial universe' >>  /etc/apt/sources.list
apt update
apt -y install lirc/xenial
apt -y install lirc-x/xenial
#sed -i "s|deb [trusted=yes] http://ca.archive.ubuntu.com/ubuntu/ xenial universe||" /etc/apt/sources.list
gedit /etc/apt/sources.list
apt update
echo " Lirc is now installed"
apt-mark hold lirc lirc-x
sleep 3
fi;;
#
b)
clear
echo "                    Installing Infra-Red Remotes Control (Eventlircd)" 
if [ -d /usr/sbin/eventlircd ]
then echo "Eventlircd is already installed"
sleep 2
else 
apt -y install gawk libudev-dev lirc evtest
update-rc.d lirc remove
cd $SRC
cp -rf $REPO/eventlircd $SRC
cp -rf $REPO/eventlircd_patch.tar.gz $SRC/eventlircd
cd eventlircd
tar -zxvf eventlircd_patch.tar.gz
rm -rf eventlircd_patch.tar.gz
patch -p1 < eventlircd_makefile.patch
patch -p1 < eventlircd_configure.patch
patch -p1 < eventlircd_version.patch
patch -p1 < 13_eventlircd_reset_lock_state.patch.x86
autoreconf -fi
./configure --sysconfdir=/etc --with-evmap-dir=/etc/eventlircd.d --with-udev-dir=/lib/udev --with-lircd-socket=/var/run/lirc/lircd
make && make install
#
echo 'uinput
i2c-dev
ir-kbd-i2c' >> /etc/modules
cd $SRC
cp -rf $REPO/eventlircd_conf.tar.gz $SRC
tar -zxvf eventlircd_conf.tar.gz
mv -f evmap.tar.gz /etc/eventlircd.d
mv -f rules.tar.gz /lib/udev/rules.d
rm -rf /lib/udev/rc_keymaps
mv -f rc_keymaps /lib/udev/
cd /lib/udev/rc_keymaps
chmod 0644 *
cd /etc/eventlircd.d
tar -zxvf evmap.tar.gz
rm -rf evmap.tar.gz
chmod 0644 *
cd /lib/udev/rules.d
#rm -rf 98-eventlircd.rules.disabled
#rm -rf 98-lircd.rules.disabled
tar -zxvf rules.tar.gz
rm -rf rules.tar.gz
chmod 0644 *
sleep 2
#
echo "                    Create Eventircd start command line (if installed)"
sleep 2
cd /etc/init.d/
rm -rf eventlircd
touch eventlircd
echo '#!/bin/sh
#
# To be copied to: /etc/init.d
# And type:
### BEGIN INIT INFO
# Provides:          Eventlircd
# Required-Start:
# Required-Stop:
# Default-Start:     0 1 2 3 4 5 6
# Default-Stop:
# Description:       Start, Stop or Restart Eventlircd
### END INIT INFO

# Shell functions sourced from /etc/rc.status:
#set -e

# Reset status of this service
# rc_reset
#
echo "Eventlircd init.d script using: $1" >> /var/log/eventlircd.log &
case "$1" in
    start)
        echo -n "Start Eventlircd "
        rm -rf /var/run/lirc/lircd
	mkdir -p /var/run/lirc
        /usr/sbin/eventlircd -e /etc/eventlircd.d
        # Remember status and be verbose
        ;;
    stop)
        echo -n "Kill Eventlircd "
        killall -9 eventlircd
        # Remember status and be verbose
        ;;
    restart)
        echo -n "Restart Eventlircd"
        $0 stop
        $0 start

        # Remember status and be quiet
        ;;
    *)
        echo "Usage: $0 {start|stop|restart}"
        exit 1
        ;;
esac
exit 0
' >> eventlircd
chmod 777 eventlircd
#
cd /usr/local/bin/
rm -rf start-eventlircd.sh
touch start-eventlircd.sh
echo '#!/bin/sh

sleep 2
sudo /etc/init.d/eventlircd start > /dev/null 2>&1' >> start-eventlircd.sh
chmod 777 start-eventlircd.sh
echo "                    Eventlircd is now installed"
sleep 2
fi;;
esac;;
#
c)
clear
echo "                    Installing Sat firmware"
sleep 2
if [ -f $SRC/driver_dvb/check ]
then echo "Sat firmwares are already installed"; sleep 2
else
cp -rf $REPO/driver_dvb.tar.gz $SRC
cd $SRC
tar -zxvf driver_dvb.tar.gz
rm -rf driver_dvb.tar.gz
cd driver_dvb
cp -rf *.fw /lib/firmware/
cd dvbsky-firmware
cp -rf *.fw /lib/firmware/
cd ../Hauppuage
#dd if=hcw88bda.sys of=/lib/firmware/dvb-fe-cx24116-1.26.90.0.fw bs=1 skip=105768 count=32290
#ln -s /lib/firmware/dvb-fe-cx24116-1.26.90.0.fw /lib/firmware/dvb-fe-cx24116.fw
cp -rf dvb-fe-cx24116.fw /lib/firmware/
echo "Sat firmwares & drivers are now installed"; sleep 2
fi;;
#
d)
clear
echo "                    Installing Ubuntu Intel-graphics-drivers"
sleep 3
if [ -f /etc/apt/sources.list.d/oibaf-ubuntu-graphics-drivers-focal.list ]
  then echo "Intel Graphics-drivers already installed"
else
add-apt-repository ppa:oibaf/graphics-drivers
apt update
apt -y upgrade
apt -y dist-upgrade
fi
#
echo "                    Installing Intel-Vaapi-driver"
sleep 3
if [ -d $SRC/ffmpeg_sources/intel-vaapi-driver ]
then echo "Intel-Vaapi-driver is already installed"
else
cd $SRC/ffmpeg_sources
cp -rf $REPO/intel-vaapi-driver $SRC/ffmpeg_sources
cd intel-vaapi-driver
./autogen.sh
./configure
make -j4 VERBOSE=1
make -j4 install
echo "Intel Graphics-drivers are now installed"; sleep 2
fi;;
#
#############################################################
#
a1)
clear
echo "                    Removing FFmpeg"
sleep 2
rm -rf $SRC/ffmpeg_sources/nv-codec-headers
rm -rf $SRC/ffmpeg_sources/ffmpeg
rm -rf /usr/local/share/ffmpeg
rm -rf /usr/share/doc/ffmpeg
echo "FFmpeg removed"; sleep 2;;
#
b1)
clear
echo "                    Removing Lirc "
apt remove lirc lirc-x
apt purge lirc lirc-x
echo "Lirc removed"; sleep 2;;

#
c1)
clear
echo "                    Removing Eventlircd"
cd /etc/init.d
update-rc.d eventlircd remove
rm -rf /etc/modules
rm -rf /etc/init.d/eventlircd
rm -rf /etc/eventlircd.d
rm -rf /usr/sbin/eventlircd
rm -rf /usr/local/bin/start-eventlircd.sh
rm -rf /etc/sudoers.d/eventlircd
rm -rf $SRC/eventlircd
echo "Eventlircd removed"; sleep 2;;
#
d1)
clear
echo "                    Removing Intel-vaapi-driver "
sleep 2
cd $PACKAGES
dpkg -r intel-vaapi.deb
rm -rf $SRC/ffmpeg_sources/intel-vaapi-driver
rm -rf $PACKAGES/intel-vaapi*
echo "Intel-vaapi-driver removed"; sleep 2;;
#
z);;
esac;;
#############################################################

3)
clear
    dialog --title "   ** Install/Remove VDR-2.6.4   **   " --infobox "

   ---------------------------------------------------------------------------------------------
        [a]  Install VDR-2.6.4
        [b]  Remove VDR-2.6.*

        [z]  Skip
   ---------------------------------------------------------------------------------------------" 0 0

    echo -n "        Enter your menu choice = Install [a] ~~ Remove [b] ~~ Skip [z]      "
    read yourch
    case $yourch in

a)
clear
echo "                    Installing VDR      "
sleep 2
echo "Installing libraries"; sleep 3
apt -y install libjpeg-dev libcap-dev libtinyxml-dev binutils libglibmm-2.4-dev g++
apt -y install libfreetype6-dev libfontconfig1-dev libfribidi-dev gettext
apt -y install libncurses5-dev libncursesw5-dev
#
cd $SRC
cp -rf $REPO/vdr-2.6.4 $SRC
ln -s $VDR vdr
#
echo "Patching VDR"
sleep 1
cd vdr
cp -rf $REPO/vdr-patches.2.6.4.tar.gz $SRC/vdr/
tar -zxvf vdr-patches.2.6.4.tar.gz
rm -rf vdr-patches.2.6.4.tar.gz
sleep 1
#
echo "                    Patching avcdescriptor"
patch -p1 < vdr_avcdescriptor.patch
echo "                    Patching config"
patch -p1 < vdr_config.patch
echo "                    Patching dvb power saving feature"
patch -p1 < vdr_dvb_power_saving_feature.patch
echo "                    Patching maxdevice"
patch -p1 < vdr_maxdevice.patch
echo "                    Patching vdr_menuorg"
patch -p1 < vdr_menuorg.patch
echo "                    Patching menuselection"
patch -p1 < vdr_menuselection.patch
echo "                    Patching svdrphosts"
patch -p1 < vdr_svdrphosts.patch
echo "                    Patching ttxtsub"
patch -p1 < vdr_ttxtsub.patch
#echo "                    Patching ttxtsub"
#patch -p1 < patch_ttxtsubs.patch
echo "                    Patching wareagleicon"
patch -p1 < vdr_wareagleicon.patch
echo "                    Patching channellscan"
patch -p1 < vdr-dvbchan.patch
echo "                    Patching zapcockpit"
patch -p1 < vdr_zapcockpit.patch
#
make && make plugins
clear
echo "                    Final compilation"
sleep 3
echo ""
make install
#checkinstall --fstrans=no --install=yes --pkgname=vdr --pkgversion "2.6.4" --pakdir=$PACKAGES --default
cp *.conf /etc/vdr
#
apt-mark hold vdr
echo "                    VDR-2.6.4 installed"; sleep 2;;
#
b)
clear
echo "                    Removing VDR-2.6.4"
sleep 1
#dpkg -r vdr
#dpkg --purge vdr
rm -rf /etc/vdr
rm -rf /usr/share/vdr
rm -rf /usr/lib/vdr
rm -rf /var/cache/vdr
rm -rf /usr/local/bin/vdrpoweroff
rm -rf /usr/local/bin/vdrrun
rm -rf /usr/local/bin/vdr-*
rm -rf /usr/bin/vdr
rm -rf /usr/local/bin/KillVdr.sh
rm -rf /home/`logname`/Scrivania/Vdr.desktop
rm -rf /home/`logname`/Scrivania/KillVdr.desktop
rm -rf /usr/share/applications/Vdr.desktop
rm -rf /usr/share/applications/KillVdr.desktop
rm -rf /etc/xdg/autostart/vdr-autostart.desktop
rm -rf /etc/xdg/autostart/vdr-server-autostart.desktop
rm -rf /etc/xdg/autostart/Oscam.desktop
cd $SRC
rm -rf vdr vdr-*
cd packages
rm -rf vdr*.deb
echo "VDR-2.6.4 removed"; sleep 2;;
#
z);;
esac;;
##############################################################################

4)
clear
    dialog --title "   ** Install/Remove VDR-Plugins   **   " --infobox "

   ---------------------------------------------------------------------------------------------

        [a]  Install VDR-2.6.4 - Plugins
        [b]  Remove VDR-2.6.4 - Plugins

        [z]  Skip

   ---------------------------------------------------------------------------------------------" 0 0

    echo -n "        Enter your menu choice = Install [a] ~~ Remove [b] ~~ Skip [z]      "
    read yourch
    case $yourch in
a)
clear
cd $SRC
mkdir -p /etc/vdr/plugins
mkdir -p /etc/vdr/themes
rm -rf /media/video
mkdir /media/video
#
clear
echo "                    Softhddevice"
sleep 2
apt -y install libx11-xcb-dev libc6-dev libogg0 libegl-dev
apt -y install libxcb-ewmh-dev libasound2-dev libxext6 libxext-dev
apt -y install libvdpau1 libavcodec-dev libavformat-dev libswresample-dev 
apt -y install libglu1-mesa-dev libgl1-mesa-dev libswscale-dev libavfilter-dev
apt -y install libxcb-dpms0-dev libxcb-glx0-dev libxcb-randr0-dev libxcb-screensaver0-dev
apt -y install libxcb-xv0-dev libxcb-image0-dev libxcb-util0-dev libxcb-icccm4-dev libxcb-keysyms1-dev
cd $VDRSRC
cp -rf $REPO/vdr-plugin-softhddevice /$VDRSRC/
mv vdr-plugin-softhddevice softhddevice
cd softhddevice
make && make install
#
echo "                    Dvbapi"
sleep 2
apt -y install libssl-dev libdvbcsa-dev
cd $VDRSRC
cp -rf $REPO/vdr-plugin-dvbapi /$VDRSRC/
mv vdr-plugin-dvbapi dvbapi
cd dvbapi
make
cd ../../..
make plugins
#
echo "                    Skinlcarsng"
sleep 2
cd $VDRSRC
cp -rf $REPO/skinlcarsng /$VDRSRC
cd skinlcarsng
make clean && make && make install
cd /etc/vdr/themes
ln -s lcars-BlueGlass.theme lcarsng-Bluegass.theme
ln -s lcars-390Lb.theme lcarsng-390Lb.theme
ln -s lcars-LbSense.theme lcarsng-LbSense.theme
#
echo "                    Iptv"
sleep 2
apt -y install vlc libcurl4 libcurl4-gnutls-dev
cd $VDRSRC
cp -rf $REPO/vdr-plugin-iptv /$VDRSRC
mv vdr-plugin-iptv iptv
cd iptv
cp -rf $REPO/patch_iptv.tar.gz /$VDRSRC/iptv
tar -zxvf patch_iptv.tar.gz
rm -rf patch_iptv.tar.gz
patch -p1 < 10_iptv_protocolext.patch
make
cd ../../..
make plugins
#
echo "                    Radio"
sleep 2
cd $VDRSRC
cp -rf $REPO/vdr-plugin-radio /$VDRSRC
mv vdr-plugin-radio radio
cd radio
make
cd ../../..
make plugins
cd $PLUGINS
mkdir -p radio
cd radio
cp -rf $VDRSRC/radio/config/mpegstill/* /$PLUGINS/radio/
cp -rf $REPO/radio_scripts.tar.gz /$PLUGINS/radio/
tar -zxvf radio_scripts.tar.gz
rm -rf radio_scripts.tar.gz
#
echo "                    Vnsiserver"
sleep 2
cd $VDRSRC
cp -rf $REPO/vdr-plugin-vnsiserver /$VDRSRC/
mv vdr-plugin-vnsiserver vnsiserver
cd vnsiserver
make && make install
#
cd $SRC/vdr
make plugins install
#
cd $REPO
chmod -R 777 *
echo "                    VDR-2.6.4 plugins installed"; sleep 2
echo "For more Vdr plugins pls visit https://github.com/fiveten59/Vdr_installer
and download Vdr_plugins_installer"; sleep 5
;;
#
b)
clear
echo "                    Removing VDR-2.6.4 plugins"
cd $VDRSRC
rm -rf softhddevice
rm -rf skinlcarsng
rm -rf iptv
rm -rf radio
rm -rf vnsiserver
rm -rf dvbapi
cd $LIB
rm -rf libvdr-softhddevice.*
rm -rf libvdr-skinlcarsng.*
rm -rf libvdr-iptv.*
rm -rf libvdr-radio.*
rm -rf libvdr-vnsiserver.*
rm -rf libvdr-dvbapi.*
echo "VDR-2.6.4 plugins removed"; sleep 2;;
z);;
#
esac;;
#############################################################

5)
clear
#
echo "                    Configuring VDR"
sleep 2
clear
#
echo "                    Installing Icons"
sleep 2
if [ -f $SRC/icone/vdr.jpg ]
then echo "Icons $Remind4"
sleep 2
else cd $SRC
cp -rf $REPO/icone.tar.gz $SRC
tar -zxvf icone.tar.gz
rm -rf icone.tar.gz
echo "Icons installed "; sleep 2
fi
#
echo "                    Installing Italian translation for some plugins"
cd $SRC
mkdir -p traduzioni
cd traduzioni
cp $REPO/traduzioni.tar.gz /$SRC/traduzioni/
tar -zxvf traduzioni.tar.gz
rm -rf traduzioni.tar.gz
echo "Italian translation installed "; sleep 2
#
echo "                    keymacros.conf setup"
rm -rf /etc/vdr/keymacros.conf
touch /etc/vdr/keymacros.conf
echo "# Remote control key macros for VDR
#
# Format:
#
# macrokey  key1 key2 key3...
# macrokey  @plugin key1 key2 key3...
#
# See man vdr(5)

Red       Recordings
Green     @channelscan
Yellow    Info
Blue      @tvguide
Ok        Channels" >> /etc/vdr/keymacros.conf
echo "keymacros installed"; sleep 2
#
echo "                    Installing True Type Fonts"
sleep 2
if [ -d /usr/share/fonts/truetype/vdrsymbols ];
then echo "                    Fonts $Remind4"
sleep 2
else cp -rf $REPO/vdrsymbols.tar.gz /usr/share/fonts/truetype/
cd /usr/share/fonts/truetype/
tar -zxvf vdrsymbols.tar.gz
rm -rf vdrsymbols.tar.gz
fc-cache -fv
echo "True Type Fonts installed"; sleep 2
fi
#
echo "                    Install Channels logos"
sleep 2
if [ -f /etc/vdr/logos/2be.png ]
then echo "Logos are already installed"
else
cp -rf $REPO/logos /etc/vdr/
echo "                    Channels logos installed"; sleep 2
fi
sleep 2
#
echo "                    Diseqc & Channells setup"
sleep 2
rm -rf /etc/vdr/diseqc.conf
rm -rf /etc/vdr/channels.conf
clear
    dialog --title "   ** diseqc.conf setup **   " --infobox "
   ----------------------------------------------
                Diseqc setup
   ----------------------------------------------

        [a]    Trial 9, 13, 19.2°E
        [b]    Dual 13, 19.2°E
        [c]    Astra 4 - 4.8°E
        [d]    Eutelsat 9°E
        [e]    Hot Bird 13°E
        [f]    Astra 19.2°E
        [g]    Astra 23°E
        [h]    Astra 28.2°E
        [i]    Turksat 42°E
        [l]    Thor 0.8°W
        [m]    Eutelsat 5°W
        [n]    Hispasat - 30°W
        [p]    Camper - 13°E

        [z]    Skip

   ---------------------------------------------- " 0 0
echo -n "        Enter your menu choice = Install [a-p] ~~ Skip [z]      "
read yourch
case $yourch in

a) clear
echo "$TRIAL" >> /etc/vdr/diseqc.conf
cd /etc/vdr/
cp -rf $REPO/channels.conf.trial.tar.gz /etc/vdr/
tar -zxvf channels.conf.trial.tar.gz
rm -rf channels.conf.trial.tar.gz
echo "                    Channell TRIAL list installed"
sleep 2;;
#
b) clear
echo "$DUAL" >> /etc/vdr/diseqc.conf
cd /etc/vdr/
cp -rf $REPO/channels.conf.dual.tar.gz /etc/vdr/
tar -zxvf channels.conf.dual.tar.gz
rm -rf channels.conf.dual.tar.gz
echo "                    Channell DUAL list installed"
sleep 2;;
#
# c);;
d)
clear
echo "$MONO9" >> /etc/vdr/diseqc.conf
cd /etc/vdr/
cp -rf $REPO/channels-w_scan2-Eutelsat_9.conf.tar.gz /etc/vdr/
tar -zxvf channels-w_scan2-Eutelsat9.conf.tar.gz
rm -rf channels-w_scan2-Eutelsat9.conf.tar.gz
echo "                    Channell MONO9 list installed"
sleep 2;;
#
e) 
clear
echo "$MONO13" >> /etc/vdr/diseqc.conf
cd /etc/vdr/
cp -rf $REPO/channels.conf.trial.tar.gz /etc/vdr/
tar -zxvf channels.conf.trial.tar.gz
rm -rf channels.conf.trial.tar.gz
echo "                    Channell MONO13 list installed"
sleep 2;;
#
f) 
clear
echo "$MONO19" >> /etc/vdr/diseqc.conf
cd /etc/vdr/
cp -rf $REPO/channels-w_scan2-Astra_19.conf.tar.gz /etc/vdr/
tar -zxvf channels-w_scan2-Astra_19.conf.tar.gz
rm -rf channels-w_scan2-Astra_19.conf.tar.gz
echo "                    Channell MONO19 list installed"
sleep 2;;
#
g)
clear
echo "$MONO23" >> /etc/vdr/diseqc.conf
cd /etc/vdr/
cp -rf $REPO/channels-w_scan2-Astra23.conf.tar.gz /etc/vdr/
tar -zxvf channels-w_scan2-Astra23.conf.tar.gz
rm -rf channels-w_scan2-Astra23.conf.tar.gz
echo "                    Channell MONO23 list installed"
sleep 2;;
#
h)
clear
echo "$MONO28" >> /etc/vdr/diseqc.conf
cd /etc/vdr/
wget https://channelpedia.yavdr.com/gen/DVB-S/S28.2E/S28.2E_complete_sorted_by_groups.channels.conf/S28.2E_complete_sorted_by_groups.channels.conf
mv -f S28.2E_complete_sorted_by_groups.channels.conf Astra28_channels.conf
cp -rf Astra28_channels.conf $REPO/
echo "                    Channell MONO28 list installed"
sleep 2;;
#
i)
clear
echo "$MONO42" >> /etc/vdr/diseqc.conf
cd /etc/vdr/
cp -rf $REPO/channels-w_scan2-Tursat.conf.tar.gz /etc/vdr/
tar -zxvf channels-w_scan2-Turksat.conf.tar.gz
rm -rf channels-w_scan2-Turksat.conf.tar.gz
echo "                    Channell MONO42 list installed"
sleep 2;;
#
l) clear
echo "$MONO08W" >> /etc/vdr/diseqc.conf
cd /etc/vdr/
cp -rf $REPO/channels-w_scan2-Thor.conf.tar.gz /etc/vdr/
tar -zxvf channels-w_scan2-Thor.conf.tar.gz
rm -rf channels-w_scan2-Thor.conf.tar.gz
echo "                    Channell MONO08W list installed"
sleep 2;;
#
m)
clear 
echo "                    Not available"
#echo "$MONO5W" >> /etc/vdr/diseqc.conf
#cd /etc/vdr/
#wget 
#tar -zxvf 
#rm -rf 
#echo "Channell MONO5W list installed"
sleep 2;;
n)
clear
echo "                    Not available"
#echo "$MONO30W" >> /etc/vdr/diseqc.conf
#cd /etc/vdr/
#cp -rf $REPO/channels-w_scan2-Eutelsat5.tar.gz
#tar -zxvf channels-w_scan2-Eutelsat5.tar.gz
#rm -rf /etc/vdr/channels-w_scan2-Eutelsat5.tar.gz
#echo "Channell MONO30W list installed"
sleep 2;;
#
p)
clear
echo "$MONO13_CAMPER" >> /etc/vdr/diseqc.conf
cd /etc/vdr/
cp -rf $REPO/channels.conf.camper.tar.gz /etc/vdr/
tar -zxvf channels.conf.camper.tar.gz
rm -rf vdr/channels.conf.camper.tar.gz
echo "                    Channell MONO13_CAMPER list installed"
sleep 2;;
#
z);;
esac
#
sleep 1
clear
    dialog --title "   ** Setup remote **   " --infobox "
   ----------------------------------------------
        Setup remote Lirc / Eventlircd
   ----------------------------------------------
		LIRC

        [a]    Mce
        [b]    Hama-Mce
        [c]    Hauppauge
        [d]    Mce-Spinel remote
        [e]    Vdr Manual

		EVENTLIRCD

        [f]    Custom Eventlircd remote

        [z]    Skip

    ---------------------------------------------- " 0 0
echo -n "        Enter your menu choice  [a-z]:      "
read yourch
case $yourch in

a)
clear
cd /etc/vdr
cp -rf $REPO/mce-remote.conf.tar.gz /etc/vdr
tar -zxvf mce-remote.conf.tar.gz
rm -rf mce-remote.conf.tar.gz
echo "                    Mce remote installed"
sleep 2;;
#
b)
clear
cd /etc/vdr
cp -rf $REPO/New-hama-mce-remote.conf.tar.gz /etc/vdr
tar -zxvf New-hama-mce-remote.conf.tar.gz
rm -rf New-hama-mce-remote.conf.tar.gz
echo "                    New Hama Mce remote installed"
sleep 2;;
#
c)
clear
cd /etc/vdr
cp -rf $REPO/hauppauge-remote.conf.tar.gz /etc/vdr
tar -zxvf hauppauge-remote.conf.tar.gz
rm -rf /etc/vdr/hauppauge-remote.conf.tar.gz
echo "                    Hauppauge remote installed"
sleep 2;;
#
d)
clear
cd /etc/vdr
cp -rf $REPO/mce-spinel.remote.conf.tar.gz /etc/vdr
tar -zxvf mce-spinel.remote.conf.tar.gz
rm -rf /etc/vdr/mce-spinel.remote.conf.tar.gz
echo "                    Mce-Spinel remote installed"
sleep 2;;
#
e) clear
cd /etc/vdr
rm -rf remote.conf
touch remote.conf;;
#
f) clear
cd /etc/vdr
cp -rf $REPO/eventlircd-remote.conf.tar.gz /etc/vdr
tar -zxvf eventlircd-remote.conf.tar.gz
rm -rf /etc/vdr/eventlircd-remote.conf.tar.gz
echo "                    Custom Eventlircd remote installed"
sleep 2;;
#
z);;
esac
#
echo "                    Oscam Setup"
sleep 2
cd /usr/local
mkdir -p etc
if [ -f $ETC/oscam.check ]
  then  echo "Oscam is already installed"
else
apt -y install libssl-dev libcrypto++-dev pcscd subversion libpcsclite-dev libusb-1.0-0-dev
cp -rf $REPO/oscam.tar.gz /$ETC/
cd $ETC
tar -zxvf oscam.tar.gz
rm -rf oscam.tar.gz
cp -rf $REPO/oscam64.tar.gz /usr/local/bin/
cd /usr/local/bin
tar -zxvf oscam64.tar.gz
rm -rf oscam64.tar.gz
chmod 777 oscam
echo "Oscam installed"; sleep 2
fi
#
echo "                    Create Oscam start command line"
sleep 2
rm -rf /etc/init.d/oscam
touch /etc/init.d/oscam

echo '#!/bin/sh
#
# To be copied to: /etc/init.d
# And type:
### BEGIN INIT INFO
# Provides:          Oscam
# Required-Start:
# Required-Stop:
# Default-Start:     0 1 2 3 4 5 6
# Default-Stop:
# Description:       Start, Stop or Restart Oscam
### END INIT INFO

# Shell functions sourced from /etc/rc.status:
set -e

# Reset status of this service
# rc_reset
#
echo "Vdr init.d script using: $1" >> /var/log/oscam.log &
case "$1" in
    start)
        echo -n "Start Oscam "
        /usr/local/bin/oscam >> /var/log/oscam.log &
        # Remember status and be verbose
        ;;
    stop)
        echo -n "Kill Oscam "
        killall -9 oscam
        # Remember status and be verbose
        ;;
    restart)
        echo -n "Restart Oscam "
        $0 stop
        $0 start

        # Remember status and be quiet
        ;;
    *)
        echo "Usage: $0 {start|stop|restart}"
        exit 1
        ;;
esac
exit 0
' >> /etc/init.d/oscam
chmod 755 /etc/init.d/oscam
echo "Oscam start command line created"; sleep 2
#
echo "                    Setup Oscam icon"
sleep 1
rm -rf /home/`logname`/Scrivania/Oscam.desktop
rm -rf /usr/share/applications/Oscam.desktop
touch /usr/share/applications/Oscam.desktop
echo "[Desktop Entry]
Version=1.0
Encoding=UTF-8
Type=Application
Name=Oscam
Description=Oscam Start
Icon=$SRC/icone/Oscam.png
Exec=/usr/local/bin/start-oscam.sh
" >> /usr/share/applications/Oscam.desktop
chmod 777 /usr/share/applications/Oscam.desktop
#
rm -rf /usr/local/bin/start-oscam.sh
touch /usr/local/bin/start-oscam.sh
echo '#!/bin/sh
sleep 10
sudo /etc/init.d/oscam start > /dev/null 2>&1
' >> /usr/local/bin/start-oscam.sh
chmod 777 /usr/local/bin/start-oscam.sh
echo "Setup Oscam icon & Oscam start created"; sleep 2
#
echo "                    Setup Kill Oscam icon"
sleep 1
rm -rf /home/`logname`/Scrivania/KillOscam.desktop
rm -rf /usr/share/applications/KillOscam.desktop
touch /usr/share/applications/KillOscam.desktop
echo "[Desktop Entry]
Version=1.0
Encoding=UTF-8
Type=Application
Name=KillOscam
Description=Kill Oscam
Icon=$SRC/icone/killoscam.png
Exec=/usr/local/bin/KillOscam.sh
" >> /usr/share/applications/KillOscam.desktop
chmod 777 /usr/share/applications/KillOscam.desktop
#
rm -rf /usr/local/bin/KillOscam.sh
touch /usr/local/bin/KillOscam.sh
echo '#!/bin/sh

sudo /etc/init.d/oscam stop > /dev/null 2>&1
' >> /usr/local/bin/KillOscam.sh
chmod 777 /usr/local/bin/KillOscam.sh
echo "Kill Oscam icon & kill Oscam created"; sleep 2
#
systemctl enable pcscd
systemctl start pcscd
#
echo "                    Setup Kill Vdr icon"
sleep 1
rm -rf /home/`logname`/Scrivania/KillVdr.desktop
rm -rf /usr/share/applications/KillVdr.desktop
touch /usr/share/applications/KillVdr.desktop
chmod 777 /usr/share/applications/KillVdr.desktop
echo "[Desktop Entry]
Version=1.0
Encoding=UTF-8
Type=Application
Name=KillVdr
Description=Kill Vdr
Icon=$SRC/icone/killvdr.png
Exec=/usr/local/bin/KillVdr.sh
" >> /usr/share/applications/KillVdr.desktop
chmod 777 /usr/share/applications/KillVdr.desktop
#
rm -rf /usr/local/bin/KillVdr.sh
touch /usr/local/bin/KillVdr.sh
echo '#!/bin/sh

sudo /etc/init.d/vdr stop > /dev/null 2>&1
' >> /usr/local/bin/KillVdr.sh
chmod 777 /usr/local/bin/KillVdr.sh
echo "Kill Vdr & Vdr start created"; sleep 2
#
echo "                    Install default Skin for Vdr"
sleep 1
if [ -f /etc/vdr/themes/checklcars ]
then echo "Default Skin is already installed"
else cp -rf $REPO/lcars_pack.tar.gz /etc/vdr/themes
cd /etc/vdr/themes
tar -zxvf lcars_pack.tar.gz
rm -rf lcars_pack.tar.gz
echo "                    Default Skin installed"; sleep 2
fi
#
echo "                    Configuring Vnsiserver"
sleep 1
cp -rf $VDRSRC/vnsiserver/vnsiserver/allowed_hosts.conf /$PLUGINS/vnsiserver
echo "Vnsiserver configured"; sleep 2
#
echo "                    Configuring Iptv"
sed -i 's/geteuid/getppid/' /usr/bin/vlc
cp -rf $REPO/iptv_conf.tar.gz /$PLUGINS/iptv/
cd $PLUGINS/iptv/
rm -rf vlc2iptv
tar -zxvf iptv_conf.tar.gz
rm -rf iptv_conf.tar.gz
echo "                    Iptv configured"; sleep 2
#
echo "                    Create Vdr vdrpoweroff"
sleep 1
rm -rf /usr/local/bin/vdrpoweroff
touch /usr/local/bin/vdrpoweroff
echo '#!/bin/sh
#file name: Kill Vdr "vdrpoweroff"
killall -9 vdr & killall -9 vlc & killall mpv
# & killall -9 oscam & shutdown -h now '  >> /usr/local/bin/vdrpoweroff
chmod 777 /usr/local/bin/vdrpoweroff
echo "Vdrpoweroff created"; sleep 2
#
echo "                    Permissions to execute Eventlircd - Vdr - Oscam"
sleep 2
rm -rf /etc/sudoers.d/eventlircd
touch /etc/sudoers.d/eventlircd
echo "eventlircd ALL=(ALL) ALL" >> /etc/sudoers.d/eventlircd
echo "%`logname` ALL=NOPASSWD: /etc/init.d/eventlircd" >> /etc/sudoers.d/eventlircd
rm -rf /etc/sudoers.d/oscam
touch /etc/sudoers.d/oscam
echo "oscam ALL=(ALL) ALL" >> /etc/sudoers.d/oscam
echo "%`logname` ALL=NOPASSWD: /etc/init.d/oscam" >> /etc/sudoers.d/oscam
rm -rf /etc/sudoers.d/vdr
touch /etc/sudoers.d/vdr
echo "vdr ALL=(ALL) ALL" >> /etc/sudoers.d/vdr
echo "%`logname` ALL=NOPASSWD: /etc/init.d/vdr" >> /etc/sudoers.d/vdr
rm -rf /etc/sudoers.d/server-vdr
touch /etc/sudoers.d/server-vdr
echo "vdr ALL=(ALL) ALL" >> /etc/sudoers.d/server-vdr
echo "%`logname` ALL=NOPASSWD: /etc/init.d/server-vdr" >> /etc/sudoers.d/server-vdr
echo "Permissions created"; sleep 2
#
echo "                    Configuring VDR & Vdr Server"
sleep 2
echo "                    Create Vdr start command line"
sleep 2
rm -rf /usr/local/bin/vdrrun
touch /usr/local/bin/vdrrun
echo '#!/bin/bash

/usr/bin/vdr -c /etc/vdr -E /var/vdr -l 3 -u root '$PLUGIN' -s /usr/local/bin/vdrpoweroff

# check system with "aplay -l"
# for hdmi nvidia audio -P softhddevice -a hw:1,n -f 
# for hdmi intel audio -P softhddevice -a hw:0,n -f ' >> /usr/local/bin/vdrrun
chmod a+x /usr/local/bin/vdrrun
#
echo "                    Create init.d Vdr"
sleep 1
rm -rf /etc/init.d/vdr
touch /etc/init.d/vdr
echo '#!/bin/sh
#
# To be copied to: /etc/init.d
# And type:
### BEGIN INIT INFO
# Provides:          VDR
# Required-Start:
# Required-Stop:
# Default-Start:     0 1 2 3 4 5 6
# Default-Stop:
# Description:       Start, Stop or Restart VDR
### END INIT INFO

# Shell functions sourced from /etc/rc.status:
set -e

# Reset status of this service
# rc_reset
#
echo "Vdr init.d script using: $1" >> /var/log/vdr.log &
case "$1" in
    start)
        echo -n "Start VDR "
        /usr/local/bin/vdrrun >> /var/log/vdr.log &
        # Remember status and be verbose
        ;;
    stop)
        echo -n "Stop VDR "

        killall -9 vlc & killall -9 vdr & killall -9 mpv
        
        # Remember status and be verbose
        ;;
    restart)
        echo -n "Restart VDR "
        $0 stop
        $0 start

        # Remember status and be quiet
        ;;
    *)
        echo "Usage: $0 {start|stop|restart}"
        exit 1
        ;;
esac
exit 0
' >> /etc/init.d/vdr
chmod 777 /etc/init.d/vdr
#
rm -rf /usr/local/bin/start-vdr.sh
touch /usr/local/bin/start-vdr.sh
echo "#!/bin/sh

sleep 3;
sudo /etc/init.d/vdr start > /dev/null 2>&1" >> /usr/local/bin/start-vdr.sh
chmod 777 /usr/local/bin/start-vdr.sh
#
echo "                    Setup Vdr icons"
sleep 2
rm -rf /home/`logname`/Scrivania/Vdr.desktop
rm -rf /usr/share/applications/Vdr.desktop
touch /usr/share/applications/Vdr.desktop
chmod 777 /usr/share/applications/Vdr.desktop
echo "[Desktop Entry]
Version=1.0
Encoding=UTF-8
Type=Application
Name=Vdr
Description=Start of Vdr
Icon=$SRC/icone/vdr.png
Exec=/usr/local/bin/start-vdr.sh
" >> /usr/share/applications/Vdr.desktop
chmod 777 /usr/share/applications/Vdr.desktop

echo "Vdr start command line created"; sleep 2
#
echo "                    Create Vdr Server start command line"
sleep 1
rm -rf /usr/local/bin/server_vdrrun
touch /usr/local/bin/server_vdrrun
echo '#!/bin/bash

/usr/bin/vdr -c /etc/vdr -E /var/vdr -l 3 -u root '$PLUGINSERVER' ' >> /usr/local/bin/server_vdrrun

chmod a+x /usr/local/bin/server_vdrrun
#
echo "                    Create init.d Vdr Server"
sleep 1
rm -rf /etc/init.d/server-vdr
touch /etc/init.d/server-vdr
echo '#!/bin/sh
#
# To be copied to: /etc/init.d
# And type:
### BEGIN INIT INFO
# Provides:          VDR
# Required-Start:
# Required-Stop:
# Default-Start:     0 1 2 3 4 5 6
# Default-Stop:
# Description:       Start, Stop or Restart VDR
### END INIT INFO

# Shell functions sourced from /etc/rc.status:
set -e

# Reset status of this service
# rc_reset
#
echo "Vdr init.d script using: $1" >> /var/log/vdr.log &
case "$1" in
    start)
        echo -n "Start VDR "
       /usr/local/bin/server_vdrrun >> /var/log/vdr.log &
        # Remember status and be verbose
        ;;
    stop)
        echo -n "Stop VDR "

        killall -9 vlc & killall -9 vdr
        
        # Remember status and be verbose
        ;;
    restart)
        echo -n "Restart VDR "
        $0 stop
        $0 start

        # Remember status and be quiet
        ;;
    *)
        echo "Usage: $0 {start|stop|restart}"
        exit 1
        ;;
esac
exit 0
' >> /etc/init.d/server-vdr
chmod 777 /etc/init.d/server-vdr
#
rm -rf /usr/local/bin/start-server-vdr.sh
touch /usr/local/bin/start-server-vdr.sh
echo "#!/bin/sh

#sleep 3
/usr/lib/x86_64-linux-gnu/kodi/kodi.bin & sudo /etc/init.d/server-vdr start > /dev/null 2>&1" >> /usr/local/bin/start-server-vdr.sh
chmod 777 /usr/local/bin/start-server-vdr.sh
#
echo "                    Setup Vdr Server icons"
sleep 3
rm -rf /home/`logname`/Scrivania/Server.desktop
rm -rf /usr/share/applications/Server.desktop
touch /usr/share/applications/Server.desktop
echo "[Desktop Entry]
Version=1.0
Encoding=UTF-8
Type=Application
Name=Server_Vdr
Description=Start of Vdr Server
Icon=$SRC/icone/server_vdr.png
Exec=/usr/local/bin/start-server-vdr.sh
" >> /usr/share/applications/Server.desktop
chmod 777 /usr/share/applications/Server.desktop
echo "Vdr Server start command line created"; sleep 2
#
echo "                    Configuring Frontend"
sleep 3
lspci | grep VGA > /tmp/videocard
if cat /tmp/videocard | grep "Intel Corporation HD Graphics "
then 
sed -i "s|-P'dvbapi'|& -P'softhddevice -v cpu-glx -f'|" /usr/local/bin/vdrrun
else 
sed -i "s|-P'dvbapi'|& -P'softhddevice -v cuvid -f'|" /usr/local/bin/vdrrun
rm -rf /tmp/videocard
fi
#
cp -rf $REPO/setup16_softhddevice.tar.gz /etc/vdr
cd /etc/vdr/
tar -zxvf setup16_softhddevice.tar.gz
rm -rf setup16_softhddevice.tar.gz
echo "Frontend configured"; sleep 2
#
echo "                    Eventlircd & Oscam Automatic start at boot"
sleep 1 
cd /etc/xdg/autostart
cp -rf $REPO/autostart.tar.gz /etc/xdg/autostart
tar -zxvf autostart.tar.gz
rm -rf autostart.tar.gz
echo "Automatic Eventlircd & Oscam installed"; sleep 2
#
clear
    dialog --title "   ** Vdr & Vdr Server Automatic start at boot **   " --infobox "
   ----------------------------------------------
        Configuring Automatic start at boot
   ----------------------------------------------

        [a]    Vdr
        [b]    Vdr Server
        [c]    No auto starting	

   ---------------------------------------------- " 0 0
echo -n "        Enter your menu choice  [a-c]:      "
read yourch
case $yourch in
a)
clear
cd /etc/xdg/autostart
rm -rf vdr-autostart.desktop
cp -rf $REPO/vdr-autostart.tar.gz /etc/xdg/autostart
tar -zxvf vdr-autostart.tar.gz
rm -rf vdr-autostart.tar.gz
echo "Automatic start Vdr installed"; sleep 2;;
b)
clear
cd /etc/xdg/autostart
rm -rf vdr-server-autostart.desktop
cp -rf $REPO/vdr_server-autostart.tar.gz /etc/xdg/autostart
tar -zxvf vdr_server-autostart.tar.gz
rm -rf vdr_server-autostart.tar.gz
echo "Automatic start Vdr Server installed"; sleep 2;;
c);;
esac
#
apt-mark hold vdr
cd /home/`logname`
chmod -R 777 Vdr_repo
#
echo "                    *** Done! ***"
sleep 3
echo "                    *** Installation completed! ***"
sleep 3
;;
#
#echo "                    *** Only for testing ***"
#sleep 3
#/usr/local/bin/start-vdr.sh;;

#############################################################

6)

clear

    dialog --title "   ** Install & Setup KODI **   " --infobox "

   --------------------------------------------------------------

        [a]    Install Kodi
        [b]    Remove Kodi

        [z]    Exit

   -------------------------------------------------------------- " 0 0

echo -n "        Enter your menu choice = Install [a] ~~ Remove [b] ~~ Exit [z]:      "
read yourch
case $yourch in

a)
clear
apt -y install software-properties-common pkg-config

clear
    dialog --title "   ** KODI **   " --infobox "
   ----------------------------------------------
                KODI versions
   ----------------------------------------------
        [a]    Kodi Stable version
        [b]    Kodi Release Candidate version
   ---------------------------------------------- " 0 0
    echo -n "        Enter your menu choice  [a-b]:      "
    read yourch
    case $yourch in

a)   clear; add-apt-repository ppa:team-xbmc/ppa; apt update; apt -y install kodi; apt -y install kodi-pvr-iptvsimple; apt install kodi-pvr-vdr-vnsi; apt-mark hold kodi;;
b)   clear; add-apt-repository ppa:team-xbmc/unstable; apt update;  apt -y install kodi; apt -y install kodi-pvr-iptvsimple; apt install kodi-pvr-vdr-vnsi; apt-mark hold kodi;;
esac
#

echo "                    Install Kill Kodi Icon"
sleep 2
cd /usr/local/bin
rm -rf /usr/local/bin/Killkodi.sh
touch /usr/local/bin/Killkodi.sh
echo '#!/bin/sh

killall -9 /usr/lib/x86_64-linux-gnu/kodi/kodi.bin && sudo /etc/init.d/server-vdr stop > /dev/null 2>&1 
# & killall -9 oscam & shutdown -h now '  >> /usr/local/bin/Killkodi.sh
chmod 777 /usr/local/bin/Killkodi.sh
#
echo "                    Setup Kill Kodi icon"
sleep 1
rm -rf /home/`logname`/Scrivania/Killkodi.desktop
rm -rf /usr/share/applications/Killkodi.desktop
touch /usr/share/applications/Killkodi.desktop
echo "[Desktop Entry]
Version=1.0
Encoding=UTF-8
Type=Application
Name=KillKodi
Description=Kill Kodi
Icon=$SRC/icone/killkodi.png
Exec=/usr/local/bin/Killkodi.sh
" >> /usr/share/applications/Killkodi.desktop
chmod 777 /usr/share/applications/Killkodi.desktop
#
echo "                    Install Kodi Picon"
sleep 1
cp -rf /home/'logname'/Vdr-repo/kodi_picon.tar.gz $ETC
cd $ETC
tar -zxvf kodi_picon.tar.gz
rm -rf kodi_picon.tar.gz
#
echo "                    Install Kodi  Lircmap"
# lsb_release -a
dmesg | grep -i 20.04 > $TEMP/release_check
if cat $TEMP/release_check | grep "20.04"; 
then echo "Ubuntu 20.04 detected" 
cd /usr/share/kodi/system
rm -rf Lircmap.xml
cp -rf /home/'logname'/Vdr-repo/Lircmap_Kodi.tar.gz /usr/share/kodi/system
tar -zxvf Lircmap_Kodi.tar.gz
rm -rf Lircmap_Kodi.tar.gz
else echo "Ubuntu 22.04 detected"
fi
rm -rf $TEMP/release_check  
#
cd $REPO/
chmod -R 777 *
#
echo "                    *** Done! ***"
sleep 3
echo "                    *** Installation completed! ***"
sleep 3

echo "                    Press Enter to continue ...               "
read enterKey;;

#############################################################

b)

clear
echo "                    Remove KODI"
sleep 3
apt remove kodi*
apt purge kodi*
rm -rf ~/.kodi/
rm -rf /home/`logname`/.kodi/*
rm -rf /usr/share/kodi
add-apt-repository --remove ppa:team-xbmc/ppa -y
add-apt-repository --remove ppa:team-xbmc/unstable -y
rm -rf /home/`logname`/Scrivania/Kodi.desktop
rm -rf /usr/share/applications/Kodi.desktop;;
#
z);;
esac;;

#############################################################

7)                                        #########################################
                                          #                Exit/Stop              #
                                          #########################################


    clear
    echo ""
    echo ""
    echo ""
    echo ""
    echo "                                             .-----,        ,.----."
    echo "                                      .-----'       '------'       ',"
    echo "                                    ,'  First ed. by mona66 ® 2010   ',"
    echo "                                    '     Updated and Revision        '"
    echo "                                    ',  by fiveten_59 ® and knap ®    ,'"
    echo "                                     ,'   2013 ~ 2014 ~ 2015 ~ 2016      ',"
    echo "                                   '           vdr_installer           '"
    echo "                                    ',        by fiveten_59 ®         '"
    echo "                                    ',               2023           ,'"
    echo "                                      '----,      ,----,       ,----'"
    echo "                                            '----'      '-----'"
    echo "                                                      O"
    echo "                                                      o "
    echo "                                                        o  "
    echo "                                                       °"
    echo "                                                        °"
    echo "                                                      .88888888:.          "
    echo "                                                    88888888.88888.          "
    echo "                                                  .8888888888888888.          "
    echo "                                                  888888888888888888          "
    echo "                                                  88'..'888'..'88888          "
    echo "                                                  88'  '888'  '88888          "
    echo "                                                  88'..':::'..':8888          "
    echo "                                                  88:::,::,:::::8888          "
    echo "                                                  88':::::::::''8888          "
    echo "                                                 .88  '::::'    8:88.          "
    echo "                                                8888            '8:888.          "
    echo "                                              .8888'             '888888.          "
    echo "                                             .8888:..  .::.  ...:'8888888:.          "
    echo "                                            .8888.'     :'     ''::'88:88888          "
    echo "                                           .8888        '         '.888:8888.          "
    echo "                                          888:8         .           888:88888          "
    echo "                                        .888:88        .:           888:88888:          "
    echo "                                        8888888.       ::           88:888888          "
    echo "                                        '.::.888.      ::          .88888888          "
    echo "                                       .::::::.888.    ::         :::'8888'.:.          "
    echo "                                      ::::::::::.888   '         .::::::::::::          "
    echo "                                      ::::::::::::.8    '      .:8::::::::::::.          "
    echo "                                    .::::::::::::::.        .:888:::::::::::::          "
    echo "                                    :::::::::::::::88:.__..:88888:::::::::::'          "
    echo "                                     ''.:::::::::::88888888888.88:::::::::'          "
    echo "                                           '':::_:' -- '' -'-' '':_::::''          "
    echo ""
    echo "                                           Thanks to all and Have fun :-)"
    echo "                                                               "
    echo ""
    exit 0

;;
*) ;;
esac
done
